CREATE OR REPLACE FUNCTION scangis_sero_cby() RETURNS text AS 'sqlC <- paste("SELECT count(*) FROM cases NATURAL JOIN case_type_attributes WHERE value=''C''",sep="");sqlB <- paste("SELECT count(*) FROM cases NATURAL JOIN case_type_attributes WHERE value=''B''",sep="");sqlY <- paste("SELECT count(*) FROM cases NATURAL JOIN case_type_attributes WHERE value=''Y''",sep="");strC <- pg.spi.exec (sqlC);strB <- pg.spi.exec (sqlB);strY <- pg.spi.exec (sqlY);str <- c(range(strC,strB),range(strY)[1]);pdf(''/tmp/graph1.pdf'');protocolNames <- c("C","B","Y");barplot(str,names.arg=protocolNames);mtext("Total number of cases",side=3);title(main="Graph 1",xlab="organized by serogroup");dev.off();print (''DONE'');' LANGUAGE plr;